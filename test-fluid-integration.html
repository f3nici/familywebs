<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Fluid Integration</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <!-- React Flow for fluid relationship lines -->
    <script src="https://cdn.jsdelivr.net/npm/reactflow@11.10.1/dist/umd/index.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reactflow@11.10.1/dist/style.css">

    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="react-flow-styles.css">
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; }
        #root { width: 100vw; height: 100vh; }
        .test-controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        .test-status {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
        }
        .status-success { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }
        .status-info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div id="root">Loading...</div>

    <script type="text/babel" src="FluidTreeWithReactFlow.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Sample test data
        const testData = {
            id: "test-tree",
            name: "Test Family Tree",
            people: {
                "p1": {
                    name: "John",
                    surname: "Smith",
                    gender: "MALE",
                    events: [
                        { type: "$_BIRTH", dateStart: "1950-01-15" }
                    ]
                },
                "p2": {
                    name: "Jane",
                    surname: "Smith",
                    gender: "FEMALE",
                    events: [
                        { type: "$_BIRTH", dateStart: "1952-03-20" }
                    ]
                },
                "p3": {
                    name: "Alice",
                    surname: "Smith",
                    gender: "FEMALE",
                    events: [
                        { type: "$_BIRTH", dateStart: "1975-06-10" }
                    ]
                },
                "p4": {
                    name: "Bob",
                    surname: "Smith",
                    gender: "MALE",
                    events: [
                        { type: "$_BIRTH", dateStart: "1977-08-22" }
                    ]
                }
            },
            mariages: [
                ["p1", "p2", "p3", "p4"]
            ]
        };

        const TestApp = () => {
            const [testStatus, setTestStatus] = useState([]);
            const [selectedPerson, setSelectedPerson] = useState(null);

            useEffect(() => {
                const statuses = [];

                // Test 1: Check if React Flow is loaded
                if (window.ReactFlow) {
                    statuses.push({ type: 'success', msg: '✅ React Flow loaded' });
                } else {
                    statuses.push({ type: 'error', msg: '❌ React Flow NOT loaded' });
                }

                // Test 2: Check if FluidTreeWithReactFlow is available
                if (window.FluidTreeWithReactFlow) {
                    statuses.push({ type: 'success', msg: '✅ FluidTreeWithReactFlow component loaded' });
                } else {
                    statuses.push({ type: 'error', msg: '❌ FluidTreeWithReactFlow NOT loaded' });
                }

                // Test 3: Check if test data is valid
                if (testData.people && Object.keys(testData.people).length > 0) {
                    statuses.push({ type: 'success', msg: `✅ Test data loaded (${Object.keys(testData.people).length} people)` });
                } else {
                    statuses.push({ type: 'error', msg: '❌ Test data invalid' });
                }

                setTestStatus(statuses);

                // Log to console
                console.log('=== Test Results ===');
                console.log('React Flow:', !!window.ReactFlow);
                console.log('FluidTreeWithReactFlow:', !!window.FluidTreeWithReactFlow);
                console.log('Test data people count:', Object.keys(testData.people).length);
            }, []);

            const FluidTreeWithReactFlow = window.FluidTreeWithReactFlow;

            return (
                <>
                    <div className="test-controls">
                        <h3 style={{ margin: '0 0 10px 0', fontSize: '16px' }}>Integration Test</h3>
                        {testStatus.map((status, idx) => (
                            <div key={idx} className={`test-status status-${status.type}`}>
                                {status.msg}
                            </div>
                        ))}
                        <div className="test-status status-info">
                            Selected: {selectedPerson || 'None'}
                        </div>
                    </div>

                    {FluidTreeWithReactFlow ? (
                        <FluidTreeWithReactFlow
                            treeData={testData}
                            selectedPerson={selectedPerson}
                            onSelectPerson={setSelectedPerson}
                        />
                    ) : (
                        <div style={{ padding: '50px', textAlign: 'center' }}>
                            <h2>FluidTreeWithReactFlow not available</h2>
                            <p>Check the console for errors</p>
                        </div>
                    )}
                </>
            );
        };

        ReactDOM.render(<TestApp />, document.getElementById('root'));
    </script>
</body>
</html>
